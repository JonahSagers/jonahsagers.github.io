<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Floating Bubble</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: #f0f8ff;
    }
    .bubble {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translate(-50%, 0);
    }
    .inner-mask {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    .inner-mask img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  </style>
</head>
<body>

  <div class="bubble bg-primary text-white rounded-circle d-flex justify-content-center align-items-center"
      style="width: 250px; height: 250px; --xPos: 0.2; --yPos: 0.3;">

    <div class="inner-mask inner-circle bg-white rounded-circle d-flex justify-content-center align-items-center" 
        style="width: 86%; height: 86%; position: relative;">

      <img src="./assets/images/Commencement.jpeg" class="item thumb rounded float-left" 
          style="--xPos: 0; --yPos: -0.11; --scaled: 0.5; width: 100%; height: 100%; object-fit: cover; z-index: 2; position: absolute;">
          
      <img src="./assets/images/Commencement_overview.jpeg" class="item rounded float-left" 
          style="--xPos: -0.12; --yPos: 0.13; width: 75%; height: 65%; object-fit: cover; position: absolute;">

      <div class="item text-dark card" 
          style="position: absolute; --xPos: 0.12; --yPos: 0; width: 160px; height: 200px;">
            Lorem Ipsum
      </div>
    </div>
  </div>

  <div class="bubble bg-primary text-white rounded-circle d-flex justify-content-center align-items-center"
      style="width: 150px; height: 150px; --xPos: 0.25; --yPos: 0.7;">

    <div class="inner-mask inner-circle bg-white rounded-circle d-flex justify-content-center align-items-center" 
        style="width: 86%; height: 86%; position: relative;">

      <img src="./assets/images/Commencement.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: -0.15; width: 100%; height: 100%; object-fit: cover; z-index: 2; position: absolute;">
          
      <img src="./assets/images/Commencement_overview.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: 0.15; width: 100%; height: 90%; object-fit: cover; position: absolute;">

      <div class="item text-dark card" 
          style="position: absolute; --xPos: 0.15; --yPos: 0; width: 120px; height: 150px;">
            Lorem Ipsum
      </div>
    </div>
  </div>

  <div class="bubble bg-primary text-white rounded-circle d-flex justify-content-center align-items-center"
      style="width: 150px; height: 150px; --xPos: 0.75; --yPos: 0.2;">

    <div class="inner-mask inner-circle bg-white rounded-circle d-flex justify-content-center align-items-center" 
        style="width: 86%; height: 86%; position: relative;">

      <img src="./assets/images/Commencement.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: -0.15; width: 100%; height: 100%; object-fit: cover; z-index: 2; position: absolute;">
          
      <img src="./assets/images/Commencement_overview.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: 0.15; width: 100%; height: 90%; object-fit: cover; position: absolute;">

      <div class="item text-dark card" 
          style="position: absolute; --xPos: 0.15; --yPos: 0; width: 120px; height: 150px;">
            Lorem Ipsum
      </div>
    </div>
  </div>

  <div class="bubble bg-primary text-white rounded-circle d-flex justify-content-center align-items-center"
      style="width: 150px; height: 150px; --xPos: 0.8; --yPos: 0.5;">

    <div class="inner-mask inner-circle bg-white rounded-circle d-flex justify-content-center align-items-center" 
        style="width: 86%; height: 86%; position: relative;">

      <img src="./assets/images/Commencement.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: -0.15; width: 100%; height: 100%; object-fit: cover; z-index: 2; position: absolute;">
          
      <img src="./assets/images/Commencement_overview.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: 0.15; width: 100%; height: 90%; object-fit: cover; position: absolute;">

      <div class="item text-dark card" 
          style="position: absolute; --xPos: 0.15; --yPos: 0; width: 120px; height: 150px;">
            Lorem Ipsum
      </div>
    </div>
  </div>

  <div class="bubble bg-primary text-white rounded-circle d-flex justify-content-center align-items-center"
      style="width: 150px; height: 150px; --xPos: 0.4; --yPos: 0.5;">

    <div class="inner-mask inner-circle bg-white rounded-circle d-flex justify-content-center align-items-center" 
        style="width: 86%; height: 86%; position: relative;">

      <img src="./assets/images/Commencement.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: -0.15; width: 100%; height: 100%; object-fit: cover; z-index: 2; position: absolute;">
          
      <img src="./assets/images/Commencement_overview.jpeg" class="item rounded float-left" 
          style="--xPos: -0.15; --yPos: 0.15; width: 100%; height: 90%; object-fit: cover; position: absolute;">

      <div class="item text-dark card" 
          style="position: absolute; --xPos: 0.15; --yPos: 0; width: 120px; height: 150px;">
            Lorem Ipsum
      </div>
    </div>
  </div>


  <script>
    // Simple Perlin noise generator
    class Perlin {
      constructor() {
        this.grad = [];
        for (let i = 0; i < 256; i++) {
          this.grad[i] = Math.random() * 2 - 1;
        }
      }

      fade(t) {
        return t * t * t * (t * (t * 6 - 15) + 10);
      }

      lerp(a, b, t) {
        return a + t * (b - a);
      }

      noise(x) {
        let xi = Math.floor(x) & 255;
        let xf = x - Math.floor(x);
        let g1 = this.grad[xi];
        let g2 = this.grad[(xi + 1) & 255];
        let dot1 = g1 * xf;
        let dot2 = g2 * (xf - 1);
        let u = this.fade(xf);
        return this.lerp(dot1, dot2, u);
      }
    }

    const perlin = new Perlin();
    const bubbles = document.getElementsByClassName('bubble');
    const xPercent = 0.7;
    const yPercent = 0.9;

    for (const bubble of bubbles){
      // bubble.xPos = (window.innerHeight * (Math.random() * yPercent)); 
      // bubble.yPos = (window.innerWidth/2 * (Math.random() * xPercent * 2 - xPercent));
      bubble.t = Math.random() * 100;
      bubble.ySpeed = 0.2 + Math.random() * 0.2;
      bubble.xPos = (parseFloat(bubble.style.getPropertyValue("--xPos")) - 0.5) * window.innerWidth - perlin.noise(bubble.t) * 500;
      bubble.yPos = parseFloat(bubble.style.getPropertyValue("--yPos")) * window.innerHeight;
      bubble.height = parseFloat(bubble.style.getPropertyValue("height"));
      bubble.size = 1;
      bubble.items = bubble.querySelectorAll('.item');
      for(const item of bubble.items){
        item.xPos = item.style.getPropertyValue("--xPos") * bubble.height;
        item.yPos = item.style.getPropertyValue("--yPos") * bubble.height;
        item.xNow = 0;
        item.yNow = 0;
        item.size = 1;
        if(item.classList.contains("thumb")){
          item.scalar = parseFloat(item.style.getPropertyValue("--scaled"));
        } else {
          item.scalar = 1;
        }
      }
      console.log(bubble.items);
    }

    function animate() {
      for(const bubble of bubbles) {
        if(bubble.matches(':hover')){
          bubble.style.setProperty("z-index", 10);
          mult = 6 - bubble.height/75;
        } else {
          bubble.style.setProperty("z-index", 1);
          mult = 1;
        }
        bubble.xNoise = bubble.xPos + perlin.noise(bubble.t) * 150;

        bubble.yPos -= bubble.ySpeed / mult; // upward speed

        bubble.size += (mult  - bubble.size) / 7;

        // Reset if the bubble floats off the top
        if (bubble.yPos < -bubble.height) {
          bubble.yPos = window.innerHeight;
        }

        for(const item of bubble.items){
          //using a square ease multiplies with the parent and creates a cubic
          //potentially swap this out for a lerp
          if(mult > 1){
            item.xNow += (item.xPos - item.xNow) / 7;
            item.yNow += (item.yPos - item.yNow) / 7;
          } else {
            item.xNow += (-item.xNow) / 7;
            item.yNow += (-item.yNow) / 7;
          }
          item.size = (1/(bubble.size/2+0.5)+0.02) * (1 - item.scalar * (item.yNow / item.yPos));
          
          item.style.transform = `translate(${item.xNow}%, ${item.yNow}%) scale(${item.size})`;
        }


        bubble.style.transform = `translate(calc(-50% + ${bubble.xNoise}px), ${bubble.yPos}px) scale(${bubble.size})`;

        // bubble.style.setProperty("--xPos", bubble.xNoise);
        // bubble.style.setProperty("--yPos", bubble.yPos);

        

        bubble.t += 0.0015 / mult;
      }
      requestAnimationFrame(animate);
    }

    animate();
  </script>

</body>
</html>
